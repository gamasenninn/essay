# 近況報告 - SPAのスクレイピングはXpathで

昨日のスクレイピング問題  
結論からいうと
 　
SPAでクラス定義が動的に変化するページなら
素直にXpathでDOM取得したほうがよい
コードはすぐ慣れるし  
きめ細かい制御もできる  

seleniumはXPath対応しているが  
BS4はXpathに対応していない   
lxmlライブラリーをかませばよい  

コードの読みやすさについてだが
解析ブロックのスタート決めてしまえば  
案外コードはシンプルになる  
たとえばul要素のli内項目を引っこ抜く場合  
uls = lxml.xpath('//hoge/div....../ul')  
で該当のulエレメントを引っこ抜いて
解析ブロックのスタートとし  
for ul in ulsでループを回し  
item01 = ul.xpath('./li[0]/div)[0].text  
item02 = ul.xpath('./li[1]/p)[0].text  
item03 = ul.xpath('./li[2]/a)[0].text  
p_list = ul.xpath('./li[2]/p/text()')  
みたいに値を取得すれば  
コードはシンプルになりデバッグもし易い  

ちなみに
SPAのDOM解析の場合は  
動的にエレメントが増減してしまうため  
タイミングで解析が失敗したりする  
seleniumなどでwait処理をして  
狙ったxpathが出現するまで待つ必要がある  
これって案外重要だったりする  
